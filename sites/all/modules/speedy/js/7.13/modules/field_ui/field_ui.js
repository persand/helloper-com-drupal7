/**
 * @file
 * Attaches the behaviors for the Field UI module.
 */(function(a){Drupal.behaviors.fieldUIFieldOverview={attach:function(b,c){a("table#field-overview",b).once("field-overview",function(){Drupal.fieldUIFieldOverview.attachUpdateSelects(this,c)})}},Drupal.fieldUIFieldOverview={attachUpdateSelects:function(b,c){var d=c.fieldWidgetTypes,e=c.fields;a(".widget-type-select",b).each(function(){this.initialValue=this.options[0].text}),a(".field-type-select",b).each(function(){this.targetSelect=a(".widget-type-select",a(this).parents("tr").eq(0)),a(this).bind("change keyup",function(){var a=this.options[this.selectedIndex].value,b=a in d?d[a]:[];this.targetSelect.fieldUIPopulateOptions(b)}),a(this).trigger("change",!1)}),a(".field-select",b).each(function(){this.targetSelect=a(".widget-type-select",a(this).parents("tr").eq(0)),this.targetTextfield=a(".label-textfield",a(this).parents("tr").eq(0)),a(this).bind("change keyup",function(b,c){var c=typeof c=="undefined"?!0:c,f=this.options[this.selectedIndex].value,g=f in e?e[f].type:null,h=f in e?e[f].widget:null,i=g&&g in d?d[g]:[];this.targetSelect.fieldUIPopulateOptions(i,h),c&&a(this.targetTextfield).attr("value",f in e?e[f].label:"")}),a(this).trigger("change",!1)})}},jQuery.fn.fieldUIPopulateOptions=function(b,c){return this.each(function(){var d=!1;b.length==0&&(b=[this.initialValue],d=!0);var e=this.options[this.selectedIndex].text,f="";jQuery.each(b,function(a,b){var d=typeof c!="undefined"&&a==c||typeof c=="undefined"&&b==e;f+='<option value="'+a+'"'+(d?' selected="selected"':"")+">"+b+"</option>"}),a(this).html(f).attr("disabled",d?"disabled":"")})},Drupal.behaviors.fieldUIDisplayOverview={attach:function(b,c){a("table#field-display-overview",b).once("field-display-overview",function(){Drupal.fieldUIOverview.attach(this,c.fieldUIRowsData,Drupal.fieldUIDisplayOverview)})}},Drupal.fieldUIOverview={attach:function(b,c,d){var e=Drupal.tableDrag[b.id];e.onDrop=this.onDrop,e.row.prototype.onSwap=this.onSwap,a("tr.draggable",b).each(function(){var b=this;if(b.id in c){var f=c[b.id];f.tableDrag=e;var g=new d[f.rowHandler](b,f);a(b).data("fieldUIRowHandler",g)}})},onChange:function(){var b=a(this),c=b.parents("tr:first").get(0),d=a(c).data("fieldUIRowHandler"),e={};e[d.name]=b.get(0);var f=d.getRegion();f!=d.region&&(a("select.field-parent",c).val(""),a.extend(e,d.regionChange(f)),d.region=f),Drupal.fieldUIOverview.AJAXRefreshRows(e)},onDrop:function(){var b=this,c=b.rowObject.element,d=a(c).data("fieldUIRowHandler");if(d!==undefined){var e=a(c).prevAll("tr.region-message").get(0),f=e.className.replace(/([^ ]+[ ]+)*region-([^ ]+)-message([ ]+[^ ]+)*/,"$2");f!=d.region&&(refreshRows=d.regionChange(f),d.region=f,Drupal.fieldUIOverview.AJAXRefreshRows(refreshRows))}},onSwap:function(b){var c=this;a("tr.region-message",c.table).each(function(){a(this).prev("tr").get(0)==c.group[c.group.length-1]&&(c.method!="keyboard"||c.direction=="down")&&c.swap("after",this),a(this).next("tr").is(":not(.draggable)")||a(this).next("tr").length==0?a(this).removeClass("region-populated").addClass("region-empty"):a(this).is(".region-empty")&&a(this).removeClass("region-empty").addClass("region-populated")})},AJAXRefreshRows:function(b){var c=[],d=[];a.each(b,function(a,b){c.push(a),d.push(b)});if(c.length){var e=a('<div class="ajax-progress ajax-progress-throbber"><div class="throbber">&nbsp;</div></div>');a(d).addClass("progress-disabled").after(e),a("input[name=refresh_rows]").val(c.join(" ")),a("input#edit-refresh").mousedown(),a(d).attr("disabled",!0)}}},Drupal.fieldUIDisplayOverview={},Drupal.fieldUIDisplayOverview.field=function(b,c){return this.row=b,this.name=c.name,this.region=c.region,this.tableDrag=c.tableDrag,this.$formatSelect=a("select.field-formatter-type",b),this.$formatSelect.change(Drupal.fieldUIOverview.onChange),this},Drupal.fieldUIDisplayOverview.field.prototype={getRegion:function(){return this.$formatSelect.val()=="hidden"?"hidden":"visible"},regionChange:function(a){var b=this.$formatSelect.val();switch(a){case"visible":if(b=="hidden")var c=this.defaultFormatter!=undefined?this.defaultFormatter:"visible";break;default:var c="hidden"}c!=undefined&&this.$formatSelect.val(c);var d={};return d[this.name]=this.$formatSelect.get(0),d}}})(jQuery);