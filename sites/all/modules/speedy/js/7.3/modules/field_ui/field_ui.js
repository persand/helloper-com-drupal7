(function($){Drupal.behaviors.fieldUIFieldOverview={attach:function(a,b){$("table#field-overview",a).once("field-overview",function(){Drupal.fieldUIFieldOverview.attachUpdateSelects(this,b)})}},Drupal.fieldUIFieldOverview={attachUpdateSelects:function(a,b){var c=b.fieldWidgetTypes,d=b.fields;$(".widget-type-select",a).each(function(){this.initialValue=this.options[0].text}),$(".field-type-select",a).each(function(){this.targetSelect=$(".widget-type-select",$(this).parents("tr").eq(0)),$(this).bind("change keyup",function(){var a=this.options[this.selectedIndex].value,b=a in c?c[a]:[];this.targetSelect.fieldUIPopulateOptions(b)}),$(this).trigger("change",!1)}),$(".field-select",a).each(function(){this.targetSelect=$(".widget-type-select",$(this).parents("tr").eq(0)),this.targetTextfield=$(".label-textfield",$(this).parents("tr").eq(0)),$(this).bind("change keyup",function(a,b){var b=typeof b=="undefined"?!0:b,e=this.options[this.selectedIndex].value,f=e in d?d[e].type:null,g=e in d?d[e].widget:null,h=f&&f in c?c[f]:[];this.targetSelect.fieldUIPopulateOptions(h,g),b&&$(this.targetTextfield).attr("value",e in d?d[e].label:"")}),$(this).trigger("change",!1)})}},jQuery.fn.fieldUIPopulateOptions=function(a,b){return this.each(function(){var c=!1;a.length==0&&(a=[this.initialValue],c=!0);var d=this.options[this.selectedIndex].text,e="";jQuery.each(a,function(a,c){var f=typeof b!="undefined"&&a==b||typeof b=="undefined"&&c==d;e+='<option value="'+a+'"'+(f?' selected="selected"':"")+">"+c+"</option>"}),$(this).html(e).attr("disabled",c?"disabled":"")})},Drupal.behaviors.fieldUIDisplayOverview={attach:function(a,b){$("table#field-display-overview",a).once("field-display-overview",function(){Drupal.fieldUIOverview.attach(this,b.fieldUIRowsData,Drupal.fieldUIDisplayOverview)})}},Drupal.fieldUIOverview={attach:function(table,rowsData,rowHandlers){var tableDrag=Drupal.tableDrag[table.id];tableDrag.onDrop=this.onDrop,tableDrag.row.prototype.onSwap=this.onSwap,$("tr.draggable",table).each(function(){var row=this;if(row.id in rowsData){var data=rowsData[row.id];data.tableDrag=tableDrag;var rowHandler=eval("new rowHandlers."+data.rowHandler+"(row, data);");$(row).data("fieldUIRowHandler",rowHandler)}})},onChange:function(){var a=$(this),b=a.parents("tr:first").get(0),c=$(b).data("fieldUIRowHandler"),d={};d[c.name]=a.get(0);var e=c.getRegion();e!=c.region&&($("select.field-parent",b).val(""),$.extend(d,c.regionChange(e)),c.region=e),Drupal.fieldUIOverview.AJAXRefreshRows(d)},onDrop:function(){var a=this,b=a.rowObject.element,c=$(b).data("fieldUIRowHandler");if(c!==undefined){var d=$(b).prevAll("tr.region-message").get(0),e=d.className.replace(/([^ ]+[ ]+)*region-([^ ]+)-message([ ]+[^ ]+)*/,"$2");e!=c.region&&(refreshRows=c.regionChange(e),c.region=e,Drupal.fieldUIOverview.AJAXRefreshRows(refreshRows))}},onSwap:function(a){var b=this;$("tr.region-message",b.table).each(function(){$(this).prev("tr").get(0)==b.group[b.group.length-1]&&(b.method!="keyboard"||b.direction=="down")&&b.swap("after",this),$(this).next("tr").is(":not(.draggable)")||$(this).next("tr").length==0?$(this).removeClass("region-populated").addClass("region-empty"):$(this).is(".region-empty")&&$(this).removeClass("region-empty").addClass("region-populated")})},AJAXRefreshRows:function(a){var b=[],c=[];$.each(a,function(a,d){b.push(a),c.push(d)});if(b.length){var d=$('<div class="ajax-progress ajax-progress-throbber"><div class="throbber">&nbsp;</div></div>');$(c).addClass("progress-disabled").after(d),$("input[name=refresh_rows]").val(b.join(" ")),$("input#edit-refresh").mousedown(),$(c).attr("disabled",!0)}}},Drupal.fieldUIDisplayOverview={},Drupal.fieldUIDisplayOverview.field=function(a,b){return this.row=a,this.name=b.name,this.region=b.region,this.tableDrag=b.tableDrag,this.$formatSelect=$("select.field-formatter-type",a),this.$formatSelect.change(Drupal.fieldUIOverview.onChange),this},Drupal.fieldUIDisplayOverview.field.prototype={getRegion:function(){return this.$formatSelect.val()=="hidden"?"hidden":"visible"},regionChange:function(a){var b=this.$formatSelect.val();switch(a){case"visible":if(b=="hidden")var c=this.defaultFormatter!=undefined?this.defaultFormatter:"visible";break;default:var c="hidden"}c!=undefined&&this.$formatSelect.val(c);var d={};return d[this.name]=this.$formatSelect.get(0),d}}})(jQuery);