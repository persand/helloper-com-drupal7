(function(a){function c(a,b){return typeof a=="undefined"?b:typeof b=="undefined"?a:a&&b}function d(a,b){return b&&typeof a!="undefined"?!a:a}function e(a,b){return a===b?typeof a=="undefined"?a:!0:typeof a=="undefined"||typeof b=="undefined"}var b=Drupal.states={postponed:[]};Drupal.behaviors.states={attach:function(c,d){for(var e in d.states)for(var f in d.states[e])new b.Dependent({element:a(e),state:b.State.sanitize(f),constraints:d.states[e][f]});while(b.postponed.length)b.postponed.shift()()}},b.Dependent=function(b){a.extend(this,{values:{},oldValue:null},b),this.dependees=this.getDependees();for(var c in this.dependees)this.initializeDependee(c,this.dependees[c])},b.Dependent.comparisons={RegExp:function(a,b){return a.test(b)},Function:function(a,b){return a(b)},Number:function(a,b){return typeof b=="string"?e(a.toString(),b):e(a,b)}},b.Dependent.prototype={initializeDependee:function(c,d){var e;this.values[c]={};for(var f in d)if(d.hasOwnProperty(f)){e=d[f];if(a.inArray(e,d)===-1)continue;e=b.State.sanitize(e),this.values[c][e.name]=null,a(c).bind("state:"+e,a.proxy(function(a){this.update(c,e,a.value)},this)),new b.Trigger({selector:c,state:e})}},compare:function(a,c,d){var f=this.values[c][d.name];return a.constructor.name in b.Dependent.comparisons?b.Dependent.comparisons[a.constructor.name](a,f):e(a,f)},update:function(a,b,c){c!==this.values[a][b.name]&&(this.values[a][b.name]=c,this.reevaluate())},reevaluate:function(){var a=this.verifyConstraints(this.constraints);a!==this.oldValue&&(this.oldValue=a,a=d(a,this.state.invert),this.element.trigger({type:"state:"+this.state,value:a,trigger:!0}))},verifyConstraints:function(b,d){var e;if(a.isArray(b)){var f=a.inArray("xor",b)===-1;for(var g=0,h=b.length;g<h;g++)if(b[g]!="xor"){var i=this.checkConstraints(b[g],d,g);if(i&&(f||e))return f;e=e||i}}else if(a.isPlainObject(b))for(var j in b)if(b.hasOwnProperty(j)){e=c(e,this.checkConstraints(b[j],d,j));if(e===!1)return!1}return e},checkConstraints:function(a,c,e){return typeof e!="string"||/[0-9]/.test(e[0])?e=null:typeof c=="undefined"&&(c=e,e=null),e!==null?(e=b.State.sanitize(e),d(this.compare(a,c,e),e.invert)):this.verifyConstraints(a,c)},getDependees:function(){var a={},b=this.compare;return this.compare=function(b,c,d){(a[c]||(a[c]=[])).push(d.name)},this.verifyConstraints(this.constraints),this.compare=b,a}},b.Trigger=function(c){a.extend(this,c),this.state in b.Trigger.states&&(this.element=a(this.selector),this.element.data("trigger:"+this.state)||this.initialize())},b.Trigger.prototype={initialize:function(){var a=b.Trigger.states[this.state];if(typeof a=="function")a.call(window,this.element);else for(var c in a)a.hasOwnProperty(c)&&this.defaultTrigger(c,a[c]);this.element.data("trigger:"+this.state,!0)},defaultTrigger:function(c,d){var e=d.call(this.element);this.element.bind(c,a.proxy(function(a){var b=d.call(this.element,a);e!==b&&(this.element.trigger({type:"state:"+this.state,value:b,oldValue:e}),e=b)},this)),b.postponed.push(a.proxy(function(){this.element.trigger({type:"state:"+this.state,value:e,oldValue:null})},this))}},b.Trigger.states={empty:{keyup:function(){return this.val()==""}},checked:{change:function(){return this.attr("checked")}},value:{keyup:function(){return this.length>1?this.filter(":checked").val()||!1:this.val()},change:function(){return this.length>1?this.filter(":checked").val()||!1:this.val()}},collapsed:{collapsed:function(a){return typeof a!="undefined"&&"value"in a?a.value:this.is(".collapsed")}}},b.State=function(a){this.pristine=this.name=a;for(;;){while(this.name.charAt(0)=="!")this.name=this.name.substring(1),this.invert=!this.invert;if(this.name in b.State.aliases)this.name=b.State.aliases[this.name];else break}},b.State.sanitize=function(a){return a instanceof b.State?a:new b.State(a)},b.State.aliases={enabled:"!disabled",invisible:"!visible",invalid:"!valid",untouched:"!touched",optional:"!required",filled:"!empty",unchecked:"!checked",irrelevant:"!relevant",expanded:"!collapsed",readwrite:"!readonly"},b.State.prototype={invert:!1,toString:function(){return this.name}},a(document).bind("state:disabled",function(b){b.trigger&&a(b.target).attr("disabled",b.value).filter(".form-element").closest(".form-item, .form-submit, .form-wrapper").toggleClass("form-disabled",b.value)}),a(document).bind("state:required",function(b){b.trigger&&(b.value?a(b.target).closest(".form-item, .form-wrapper").find("label").append('<span class="form-required">*</span>'):a(b.target).closest(".form-item, .form-wrapper").find("label .form-required").remove())}),a(document).bind("state:visible",function(b){b.trigger&&a(b.target).closest(".form-item, .form-submit, .form-wrapper").toggle(b.value)}),a(document).bind("state:checked",function(b){b.trigger&&a(b.target).attr("checked",b.value)}),a(document).bind("state:collapsed",function(b){b.trigger&&a(b.target).is(".collapsed")!==b.value&&a("> legend a",b.target).click()})})(jQuery);