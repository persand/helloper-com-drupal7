/**
 * @file
 * Attaches behaviors for the Dashboard module.
 */(function(a){Drupal.behaviors.dashboard={attach:function(b,c){a("#dashboard",b).once(function(){a(this).prepend('<div class="customize clearfix"><ul class="action-links"><li><a href="#">'+Drupal.t("Customize dashboard")+'</a></li></ul><div class="canvas"></div></div>'),a(".customize .action-links a",this).click(Drupal.behaviors.dashboard.enterCustomizeMode)}),Drupal.behaviors.dashboard.addPlaceholders(),Drupal.settings.dashboard.launchCustomize&&Drupal.behaviors.dashboard.enterCustomizeMode()},addPlaceholders:function(){a("#dashboard .dashboard-region .region").each(function(){var b="";a(".block",this).length==0?(a("#dashboard").hasClass("customize-mode")?b=Drupal.settings.dashboard.emptyRegionTextActive:b=Drupal.settings.dashboard.emptyRegionTextInactive,a(".placeholder",this).length==0&&a(this).append('<div class="placeholder"></div>'),a(".placeholder",this).html(b)):a(".placeholder",this).remove()})},enterCustomizeMode:function(){a("#dashboard").addClass("customize-mode customize-inactive"),Drupal.behaviors.dashboard.addPlaceholders(),a("#dashboard .customize .action-links").hide(),a("div.customize .canvas").load(Drupal.settings.dashboard.drawer,Drupal.behaviors.dashboard.setupDrawer)},exitCustomizeMode:function(){a("#dashboard").removeClass("customize-mode customize-inactive"),Drupal.behaviors.dashboard.addPlaceholders(),location.href=Drupal.settings.dashboard.dashboard},setupDrawer:function(){a("div.customize .canvas-content input").click(Drupal.behaviors.dashboard.exitCustomizeMode),a("div.customize .canvas-content").append('<a class="button" href="'+Drupal.settings.dashboard.dashboard+'">'+Drupal.t("Done")+"</a>");var b=a("#dashboard div.region");b.sortable({connectWith:b,cursor:"move",cursorAt:{top:0},dropOnEmpty:!0,items:"> div.block, > div.disabled-block",placeholder:"block-placeholder clearfix",tolerance:"pointer",start:Drupal.behaviors.dashboard.start,over:Drupal.behaviors.dashboard.over,sort:Drupal.behaviors.dashboard.sort,update:Drupal.behaviors.dashboard.update})},start:function(b,c){a("#dashboard").removeClass("customize-inactive");var d=a(c.item);d.hasClass("disabled-block")||d.css({height:"auto"})},over:function(b,c){var d=a(c.item);a(this).closest("#disabled-blocks").length?d.css("width",""):d.css("width",a(this).width())},sort:function(b,c){var d=a(c.item);b.pageX>c.offset.left+d.width()&&d.css("left",b.pageX)},update:function(b,c){a("#dashboard").addClass("customize-inactive");var d=a(c.item);if(d.hasClass("disabled-block")){var e,f,g;g=d.attr("class"),e=g.match(/\bmodule-(\S+)\b/)[1],f=g.match(/\bdelta-(\S+)\b/)[1],a.get(Drupal.settings.dashboard.blockContent+"/"+e+"/"+f,{},function(a){a&&d.html(a),d.find("div.content").is(":empty")&&d.find("div.content").html(Drupal.settings.dashboard.emptyBlockText),Drupal.attachBehaviors(d)},"html"),d.removeClass("disabled-block")}Drupal.behaviors.dashboard.addPlaceholders(),a.post(Drupal.settings.dashboard.updatePath,{form_token:Drupal.settings.dashboard.formToken,regions:Drupal.behaviors.dashboard.getOrder})},getOrder:function(){var b=[];return a("#dashboard div.region").each(function(){var c=a(this).parent().attr("id").replace(/-/g,"_"),d=a(this).sortable("toArray");a.each(d,function(){b.push(c+"[]="+this)})}),b=b.join("&"),b}}})(jQuery);