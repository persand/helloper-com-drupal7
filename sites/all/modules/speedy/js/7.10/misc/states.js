(function(a){var b=Drupal.states={postponed:[]};Drupal.behaviors.states={attach:function(c,d){for(var e in d.states)for(var f in d.states[e])new b.Dependent({element:a(e),state:b.State.sanitize(f),dependees:d.states[e][f]});while(b.postponed.length)b.postponed.shift()()}},b.Dependent=function(b){a.extend(this,{values:{},oldValue:undefined},b);for(var c in this.dependees)this.initializeDependee(c,this.dependees[c])},b.Dependent.comparisons={RegExp:function(a,b){return a.test(b)},Function:function(a,b){return a(b)},Number:function(a,b){return b.constructor.name==="String"?e(String(a),b):e(a,b)}},b.Dependent.prototype={initializeDependee:function(c,d){var e=this;e.values[c]={},a.each(d,function(d,f){d=b.State.sanitize(d),e.values[c][d.pristine]=undefined,a(c).bind("state:"+d,function(a){var b=e.compare(f,a.value);e.update(c,d,b)}),new b.Trigger({selector:c,state:d})})},compare:function(a,c){return a.constructor.name in b.Dependent.comparisons?b.Dependent.comparisons[a.constructor.name](a,c):e(a,c)},update:function(a,b,c){c!==this.values[a][b.pristine]&&(this.values[a][b.pristine]=c,this.reevaluate())},reevaluate:function(){var a=undefined;for(var e in this.values)for(var f in this.values[e]){f=b.State.sanitize(f);var g=this.values[e][f.pristine];a=c(a,d(g,f.invert))}a!==this.oldValue&&(this.oldValue=a,a=d(a,this.state.invert),this.element.trigger({type:"state:"+this.state,value:a,trigger:!0}))}},b.Trigger=function(c){a.extend(this,c),this.state in b.Trigger.states&&(this.element=a(this.selector),this.element.data("trigger:"+this.state)||this.initialize())},b.Trigger.prototype={initialize:function(){var c=this,d=b.Trigger.states[this.state];typeof d=="function"?d.call(window,this.element):a.each(d,function(a,b){c.defaultTrigger(a,b)}),this.element.data("trigger:"+this.state,!0)},defaultTrigger:function(a,c){var d=this,e=c.call(this.element);this.element.bind(a,function(a){var b=c.call(d.element,a);e!==b&&(d.element.trigger({type:"state:"+d.state,value:b,oldValue:e}),e=b)}),b.postponed.push(function(){d.element.trigger({type:"state:"+d.state,value:e,oldValue:undefined})})}},b.Trigger.states={empty:{keyup:function(){return this.val()==""}},checked:{change:function(){return this.attr("checked")}},value:{keyup:function(){return this.length>1?this.filter(":checked").val()||!1:this.val()},change:function(){return this.length>1?this.filter(":checked").val()||!1:this.val()}},collapsed:{collapsed:function(a){return a!==undefined&&"value"in a?a.value:this.is(".collapsed")}}},b.State=function(a){this.pristine=this.name=a;for(;;){while(this.name.charAt(0)=="!")this.name=this.name.substring(1),this.invert=!this.invert;if(this.name in b.State.aliases)this.name=b.State.aliases[this.name];else break}},b.State.sanitize=function(a){return a instanceof b.State?a:new b.State(a)},b.State.aliases={enabled:"!disabled",invisible:"!visible",invalid:"!valid",untouched:"!touched",optional:"!required",filled:"!empty",unchecked:"!checked",irrelevant:"!relevant",expanded:"!collapsed",readwrite:"!readonly"},b.State.prototype={invert:!1,toString:function(){return this.name}},a(document).bind("state:disabled",function(b){b.trigger&&a(b.target).attr("disabled",b.value).filter(".form-element").closest(".form-item, .form-submit, .form-wrapper")[b.value?"addClass":"removeClass"]("form-disabled")}),a(document).bind("state:required",function(b){b.trigger&&(b.value?a(b.target).closest(".form-item, .form-wrapper").find("label").append('<span class="form-required">*</span>'):a(b.target).closest(".form-item, .form-wrapper").find("label .form-required").remove())}),a(document).bind("state:visible",function(b){b.trigger&&a(b.target).closest(".form-item, .form-submit, .form-wrapper")[b.value?"show":"hide"]()}),a(document).bind("state:checked",function(b){b.trigger&&a(b.target).attr("checked",b.value)}),a(document).bind("state:collapsed",function(b){b.trigger&&a(b.target).is(".collapsed")!==b.value&&a("> legend a",b.target).click()});function c(a,b){return a===undefined?b:b===undefined?a:a&&b}function d(a,b){return b&&a!==undefined?!a:a}function e(a,b){return a===b?a===undefined?a:!0:a===undefined||b===undefined}})(jQuery);